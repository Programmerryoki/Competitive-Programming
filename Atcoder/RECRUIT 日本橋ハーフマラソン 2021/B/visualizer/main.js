!function(t){var e={};function i(r){if(e[r])return e[r].exports;var n=e[r]={i:r,l:!1,exports:{}};return t[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(r,n,function(e){return t[e]}.bind(null,n));return r},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";var r,n;!function(t){var e=function(){function t(t,e){this.filename=t,this.content=[];for(var i=0,r=e.trim().split("\n");i<r.length;i++){var n=r[i].trim().split(new RegExp("\\s+"));this.content.push(n)}this.y=0,this.x=0}return t.prototype.isEOF=function(){return this.content.length<=this.y},t.prototype.getWord=function(){this.isEOF()&&this.reportError("a word expected, but EOF"),this.content[this.y].length<=this.x&&this.reportError("a word expected, but newline");var t=this.content[this.y][this.x];return this.x+=1,t},t.prototype.getInt=function(){var t=this.getWord();return t.match(new RegExp("^[-+]?[0-9]+$"))||this.reportError("a number expected, but word "+JSON.stringify(this.content[this.y][this.x])),parseInt(t)},t.prototype.getNewline=function(){this.isEOF()&&this.reportError("newline expected, but EOF"),this.x<this.content[this.y].length&&this.reportError("newline expected, but word "+JSON.stringify(this.content[this.y][this.x])),this.x=0,this.y+=1},t.prototype.reportError=function(t){throw t=this.filename+": line "+(this.y+1)+": "+t,alert(t),new Error(t)},t}();t.FileParser=e;var i=function(){function t(t){var e=this;this.callback=t,this.inputFile=document.getElementById("inputFile"),this.outputFile=document.getElementById("outputFile"),this.reloadButton=document.getElementById("reloadButton"),this.reloadFilesClosure=function(){e.reloadFiles()},this.inputFile.addEventListener("change",this.reloadFilesClosure),this.outputFile.addEventListener("change",this.reloadFilesClosure),this.reloadButton.addEventListener("click",this.reloadFilesClosure)}return t.prototype.reloadFiles=function(){var t=this;null!=this.inputFile.files&&0!=this.inputFile.files.length&&r(this.inputFile.files[0],(function(e){null!=t.outputFile.files&&0!=t.outputFile.files.length&&r(t.outputFile.files[0],(function(i){t.reloadButton.classList.remove("disabled"),void 0!==t.callback&&t.callback(e,i)}))}))},t}();t.FileSelector=i;var r=function(t,e){var i=new FileReader;i.readAsText(t),i.onloadend=function(){"string"==typeof i.result&&e(i.result)}},n=function(t){document.getElementById("saveAsImage").addEventListener("click",(function(){!function(t,e){var i=document.createElement("a");i.href=t,i.download=e;var r=document.createEvent("MouseEvent");r.initEvent("click",!0,!0),i.dispatchEvent(r)}(t.toDataURL("image/png"),"canvas.png")}))};t.FileExporter=n}(r||(r={})),function(t){var e=function(t){var e=new r.FileParser("<input-file>",t);this.N=e.getInt(),e.getNewline(),this.E=[];for(var i=0;i<this.N;i++){this.E.push([]);for(var n=0;n<this.N;n++)this.E[i].push(e.getInt());e.getNewline()}},i=function(t,e){this.inputFile=t;var i=new r.FileParser("<output-file>",e);this.P=[];for(var n=0;n<t.N;n++){n&&i.getNewline(),this.P.push([]);for(var o=0;o<t.N;o++){var s=i.getInt();(s<0||s>t.N)&&i.reportError(n+" 行 "+o+" 列のマッサージチェアのパワーが異常です"),this.P[n].push(s)}}},n=function(){function t(t,e,i){this.turn=t,this.inputFile=e,this.outputFile=i,this.score=0,this.V=[],this.calcScore()}return t.prototype.calcScore=function(){for(var t=this.inputFile.E,e=this.outputFile.P,i=t.length,r=0;r<i;r++)for(var n=0;n<i;n++){if(0!=e[r][n])for(var o=e[r][n],s=r-o;s<=r+o;s++)if(!(s<0||s>=i))for(var l=o-Math.abs(s-r),h=n-l;h<=n+l;h++)if(!(h<0||h>=i||s==r&&h==n||0==e[s][h]))throw Error(r+" 行 "+n+" のマッサージチェアの動作音の範囲内 ("+s+", "+h+") にパワーが0ではないマッサージチェアが存在します");this.score+=t[r][n]*e[r][n]}},t.createInitialFrame=function(e,i){return new t(0,e,i)},t}(),o=function(t,r){try{var o=new e(t),s=new i(o,r);this.frames=[n.createInitialFrame(o,s)]}catch(t){throw alert(t),t}},s=function(){function t(){this.bgColor="#eee",this.font="11px Arial, meiryo, sans-serif",this.N=40,this.canvas=document.getElementById("canvas"),this.height=this.width=this.boardSize=800,this.cellSize=this.boardSize/this.N,this.ctx=this.canvas.getContext("2d"),null==this.ctx&&alert("unsupported browser"),this.scoreInput=document.getElementById("scoreInput"),this.ctx.lineJoin="round",this.ctx.textAlign="center",this.ctx.textBaseline="middle"}return t.prototype.inputFile=function(t){this.N=t.N,this.cellSize=this.height/this.N},t.prototype.draw=function(t,e){this.scoreInput.value=t.score.toString(),this.drawAll(t)},t.prototype.drawAll=function(t){var e=t.outputFile.inputFile.N;this.cellSize;this.ctx.fillStyle=this.bgColor,this.ctx.fillRect(0,0,this.boardSize,this.height),this.ctx.fillStyle="white",this.ctx.fillRect(this.boardSize,0,this.width-this.boardSize,this.boardSize),this.ctx.strokeStyle="#666",this.ctx.lineWidth=1,this.ctx.beginPath();for(var i=0;i<e+1;i++)this.ctx.moveTo(i*this.cellSize,0),this.ctx.lineTo(i*this.cellSize,this.boardSize);for(var r=0;r<e+1;r++)this.ctx.moveTo(0,r*this.cellSize),this.ctx.lineTo(this.boardSize,r*this.cellSize);this.ctx.stroke(),this.ctx.lineWidth=1,this.ctx.font=this.font;for(r=0;r<e;r++)for(i=0;i<e;i++)this.drawCell(t,r,i);for(r=0;r<e;r++)for(i=0;i<e;i++)this.drawPower(r,i,t.outputFile.P[r][i]);this.ctx.fillStyle="rgba(255, 255, 255, 0)",this.ctx.fillRect(this.width-1,this.height-1,1,1)},t.prototype.drawCell=function(t,e,i){var r=t.inputFile.E,n=t.outputFile.P,o=this.cellSize,s=r[e][i].toString();this.ctx.strokeStyle=this.ctx.fillStyle=n[e][i]?"#222":"#aaa";if(this.ctx.font=(n[e][i]?"bold ":"")+"11px Arial, meiryo, sans-serif",this.ctx.fillText(s,(i+.5)*o,(e+.55)*o),n[e][i]){this.ctx.beginPath();var l=.4*o+2*(n[e][i]-1);this.ctx.arc((i+.5)*o,(e+.5)*o,l,0,2*Math.PI),this.ctx.stroke()}},t.prototype.drawPower=function(t,e,i){var r=this.cellSize;if(!(i<=0)){var n=(e+.5)*r,o=(t-i)*r+.1*r,s=(i+.5)*r-.1*r;this.ctx.beginPath(),this.ctx.moveTo(n,o),this.ctx.lineTo(n+=s,o+=s),this.ctx.lineTo(n-=s,o+=s),this.ctx.lineTo(n-=s,o-=s),this.ctx.closePath(),this.ctx.strokeStyle="#400",this.ctx.fillStyle="rgba(200, 80, 80, 0.2)",this.ctx.fill(),this.ctx.stroke()}},t.prototype.getCanvas=function(){return this.canvas},t}(),l=function(){var t=this;this.tester=null,this.visualizer=new s,this.exporter=new r.FileExporter(this.visualizer.getCanvas()),this.loader=new r.FileSelector((function(e,i){t.tester=new o(e,i),t.visualizer.inputFile(t.tester.frames[0].outputFile.inputFile),t.visualizer.draw(t.tester.frames[t.tester.frames.length-1],null)}))};t.App=l}(n||(n={})),window.onload=function(){new n.App}}]);